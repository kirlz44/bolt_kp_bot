Давай сделаем нового телеграм бота. Для этого нужно создать директорию проекта, назови ее kp_bot. бот будет построен на движке node.js. В боте есть четыре типа пользователей Суперадмин (назначается в файле .env по телеграм id бот должен проводить проверку и узнавать супер админа), админ это пользователь добавленный в специальный чат (id чата админов также указывается в файле .env), партнер - это пользователь бота добавленный в специальный чат партнеров (id чата указываетс в файле .env) и пользователь. (для всех должны быть отдельные файлы конфигурации в боте). При каждом действии пользователя в боте, бот должен проверять статус пользователя. 

Тестирование:
Как будет организовано тестирование бота? Возможно, стоит внедрить автоматические тесты для ключевых функций.

Логирование и Мониторинг:
Как вы планируете отслеживать работу бота и выявлять ошибки? Рекомендуется использовать логирование и инструменты мониторинга.

Постепенная Реализация.


Базовые вводные:
Движок node.js
БД Postgres через Prisma (установлена локально название БД kp_base)
# Telegram Bot
BOT_TOKEN=7947032180:AAF0NqDScfYuzX0kE9WCQeWqdwQq0CpLMaM
ADMIN_CHAT_ID=-1002386144114
SUPER_ADMIN_ID=228238854
PARTNER_CHAT_ID=-1002418048814
телеграм канал t.me/+HXj790SP9DgyYzdi с рекламной информацией

# Database
DATABASE_URL="postgresql://postgres:Zxcvbn77@localhost:5432/kp_base"

# RoboKassa Production (Боевой режим)
ROBOKASSA_PROD_LOGIN=igraprinyatie_bot
ROBOKASSA_PROD_PASSWORD1=yAWz99Bmk1GeAfGQ20LL
ROBOKASSA_PROD_PASSWORD2=I9QezlQ7RM19hNW6lZgn

# RoboKassa Test (Тестовый режим)
ROBOKASSA_TEST_LOGIN=igraprinyatie_bot
ROBOKASSA_TEST_PASSWORD1=bXIzxm7xy398ZUHjQaN9
ROBOKASSA_TEST_PASSWORD2=wXjB7YCm4sF5U86IHVZI

# Текущий режим (true = тестовый, false = боевой)
ROBOKASSA_TEST_MODE=true

Оплата Робокасса (должен быть реализован тестовый и боевой режим в файле .env должны быть графы для тестового и боевого пароля. Переключение режима в файле .env)

Реферальная программа:
Первый уровень реферальной программы это пользователи зарегистрировавшиеся по ссылке пользователя.
Второй уровень реферальной программы это пользователи зарегистрировавшиеся по ссылке твоего реферала.
Статус пользователь 5% от рефералов первого уровня и 2,5% от рефералов второго уровня начисляются куражики от всех покупок в боте за деньги через робокассу.
Статус партнер 10% от рефералов первого уровня и 5% от рефералов второго уровня начисляются куражики от всех покупок в боте за деньги через робокассу.
За приглашенного нового пользователя по реферальной ссылке 500 куражиков, за приглашенных новых пользователей твоими рефералами 100 куражиков.

Уведомления:
Каждое воскресенье СуперАдмину приходит информация ТОП-5 Самых активных пользователей по отдельно по размещению постов, отдельно по привлечению новых пользователей через реферальную ссылку. В этом сообщении должна быть инлайн кнопка "Премировать" под каждым пользователем. При нажатии СуперАдмин вводит произвольное число и эта сумма добавляется пользователю к его балансу куражиков, и этому пользователю приходит сообщение "Вам пришла премия за Вашу активность от Бориса, в размере "количество куражиков" куражиков!.
Автоматическая отправка ТОП-5 пользователей каждое воскресенье в 07:00 по МСК, требует планировщика задач (например, node-cron)
При создании игры или мероприятия всем пользователям происходит автоматическая рассылка с информацией об игре или мероприятии и где его найти в меню.
После записи на игру или мероприятие, пользователю приходит уведомление за сутки и за один час до игры или мероприятия.   

Дополнительная информация:
Из всех подменю должна быть реализована кнопка возврата в главное меню
В меню и подменю должна быть создана кнопка инструкция с подробным описанием как пользоваться тем или иным разделом.
Основное меню всех пользователей (открывается независимо от статуса пользователя, отличается только для каждого статуса)
Квалификация производится только для пользователей, которые не являются СуперАдмином или админом (проверяет в файле .env суперадмина, и админа проверяет в админском чате) и запускают бота впервые.
Используйте middleware для проверки прав пользователя при выполнении действий.
.


При запуске бота для пользователей и партнеров приходит следующее сообщение в боте "Рады поприветствовать тебя "firstname telegram" в боте Студии игр "Кураж-Продаж"! Нажми кнопку "Кураж!" для запуска бота (и к этому сообщению создается инлайн кнопка "Кураж!" (все кнопки в боте должны быть с эмодзи соответствующие данному слову в кнопке, нативно понятны - это относится и к другим инлайн кнопкам). 
После нажатия пользователем или партнером инлайн кнопки "Кураж!" Бот присылает сообщение "Нам важно знать кто вы" с инлайн кнопками (не забывай про эмодзи) 1. Предприниматель/Эксперт 2. Игропрактик, провожу игры 3. Организатор фестивалей 4. Бизнес-тренер 5. Руководитель или HR 6. Интересна ваша движуха 7. Саморазвитие или команда поддержки 8. Автор игр 9. Психолог 10. Хочу создать свою игру 11. Сетевой MLM-бизнес 12. Бьюти сфера. 
После выбора квалификации партнером или пользователем бот сохраняет его квалификацию в бд (Базу данных используем postgres и работаем через prisma), и присылает Видео от создателя игры соответствующее данной квалификации встроенное в сообщение "В нашем боте вы можете, ежедневно вращать колесо фортуны, зарабатывать Куражики, записываться на игры или мероприятия также начисляется 1000 куражиков (начисляется один раз) в качестве приветствия и показывается баланс куражиков (баланс куражиков всегда обнавляется из БД) и реферальная ссылка для приглашения друзей в бот. (еще добавь описание из сайта @Web @https://kuraj-prodaj.com/) и появляется меню с инлайн кнопками: 



Меню:
"Стать партнером" - эта кнопка дает возможность пользователю сменить статус с пользователя на партнера. Цена партнерства 500 руб. или 1000 куражиков за 30 дней. После перехода по этой кнопки бот присылает сообщение для пользователя с информацией кто такой партнер (Повышенный реферальный бонус 10% от рефералов 1 уровня и 5% от рефералов 2 уровня) после оплаты присылает ссылку на закрытый чат партнеров. При переходе в чат, бот отслеживает срок членства партнера и за три, за два и за 1 дня до окончания членства присылает пользователю уведомление что ему необходимо продлить партнерство либо его статус изменится на Пользователь и он будет удален из Закрытого чата партнеров, в сообщение встроена инлайн кнопка оплатить и оплатить куражиками. При продлении партнерства предоставляется скидка 10% на оплату в рублях или куражиках (id чата партнеров нужно добавить в файле .env). Если пользователь не продлевает партнерство бот удаляет его из Закрытого чата партнеров и меняет ему статус на пользователя.

"Крутить колесо фортуны" - эта кнопка дает возможность выиграть приз, установленный админом, в колесе фортуны. Стоимость вращения колеса фортуны 700 куражиков, списываются из баланса пользователя, при недостаточном балансе, бот уведомляет пользователя что он может заработать еще Куражики для этого ему нужно пригласить новых пользователей по реферальной ссылке или перейти в раздел "Заработать" главного меню.

"Маркетплейс" - эта кнопка дает возможность посмотреть и купить товары добавленные админом, которых хранятся в БД. При нажатии на кнопку бот присылает сообщение со списком товаров (Название, цена в рублях, цена в куражиках), только тех товаров остатки которых больше "0", и инлайн кнопкой "Каталог". При нажатии на кнопку каталог пользователю приходят карточки товаров с инлайн кнопкой оплатить и оплатить куражиками. При нажатии на кнопку оплатить реализуется процесс оплаты через робокассу, при нажатии на кнопку оплатить куражиками, при достаточном балансе списываются куражики. Если оплата проведена успешна, то в админский чат приходит уведомление с информацией о купленном товаре и информацией о пользователе купившем товар и просьбой связаться с ним и инлайн кнопкой выполнено, которая фиксирует кто из админов нажал эту кнопку и связался с пользователем, редактируя это сообщение и добавляя в него юзернейм и ферстнейм админа который связался с пользователем. При оплате товара рублями если у пользователя есть реферер, то рефереру первого и второго уровня начисляется процент от покупки этого пользователя.

"Игры" - эта кнопка показывает в сообщении список доступных и информацию о них. Пользователь должен иметь возможность записаться на любую игру. Если игра платная то пользователь должен оплатить игру в куражиках или рублях через робокассу если игра создана Админом. Если игра создана Партнером, то пользователь должен оплатить игру по реквизитам указанным партнером и после прикрепить фото оплаты (это фото пересылается партнеру создавшему игру). Если пользователь оплатит игру созданную партнером в куражиках, то эта сумма зачисляется на баланс Партнера. После оплаты Бот запрашивает номер телефона пользователя и добавляет эту информацию в БД, Информация о пользователе с его номером телефона добавляется в список участников (для каждой игры создаются поля в БД).

"Заработать" - эта кнопка предоставляет информацию о том как можно заработать в боте "Студии Кураж-Продаж" а также с ссылкой на телеграм канал t.me/+HXj790SP9DgyYzdi с рекламной информацией и предлагает выбрать одну из соц.сетей для размещения рекламы. После выбора соц сети пользователь должен отправить скриншот в бот о размещении поста в этой соцсети. Этот скриншот с информацией о пользователе (для обратной связи) пересылается ботом в админский чат с инлайн кнопками "подтвердить" и "отклонить". После нажатия админом подтвердить бот редактирует это сообщение и добавляет в него информацию какой админ подтвердил или отменил этот пост, пользователю начисляется баланс куражиков, установленный суперадмином для этой соцсети, и присылается сообщение в зависимости что нажал админ (Вам начислено "количество куражиков" за размещенный пост или Ваш пост отклонен).

"Мероприятия" - эта кнопка дает возможность посмотреть доступные мероприятия созданные админом и записаться на них. Если мероприятие платное пользователь оплачивает его рублями (логика работы робокассы) или куражиками если доступна оплата куражиками. После бот запрашивает номер телефона пользователя и записывает его на это мероприятие (для каждого мероприятия создаются новые поля в БД) и сообщает об успехе пользователю.

"Реферальная программа" - в этом подменю указывается информация реферальная ссылка, статус пользователя, его балансе куражиков, сколько он пригласил пользователей первого уровня и сколько у него пользователей второго уровня. Сколько заработано куражиков от пользователей первого и второго уровня. Сколько заработано куражиков за активность (размещение рекламных постов). В нем есть инлайн кнопка получить реферальную ссылку.

"Помощь" - эта кнопка дает возможность отправить сообщение в админский чат. Если пользователь нажал на нее бот предлагает ему ввести сообщение и пересылает его в админский чат с информацией о пользователе и инлайн кнопкой принято. При нажатии кнопки принято в админском чате бот редактирует сообщение и добавляет информацию об админе, который нажал принять. 

В партнерском меню добавляется еще одна инлайн кнопка: 
"Мои игры" - эта кнопка дает возможность создать игру и посмотреть созданные игры. Партнер указывает дату, время, место, цену в рублях, цену в куражиках (если не доступна оплата в куражиках, партнер должен указать 0) и количество игроков. При просмотре созданных игр партнер может отменить игру или перенести время, а также посмотреть список зарегистрировавшихся на игру участников с их firstname username и номером телефона. Если партнер отменяет или переносит игру, всем пользователя зарегистрировавшемся на игру приходит уведомление с информацией об отмене/переносе игры и  firstname и username партнера создавшего игру для связи с ним. 

В меню супер админа и админа добавляется еще одна кнопка "Панель администартора".
"Панель администратора" - при нажатии открывается меню администратора, в котором есть инлайн кнопки:

"Приветственные видео". Эта кнопка дает возможность загрузить видео для приветствия одной из двеннадцати квалификаций пользователей, загрузка происходит через телеграм, данные о видео хранятся в бд через file id и связываются с категорией. Если видео для категории загружено админ должен это видеть и может удалить видео чтобы загрузить новое. 

"Управление колесом фортуны". Эта кнопка дает возможность установить призы в колесе фортуны. Типы призов Куражики, Скидка на товар, Специальный приз. Администратор может добавить новый приз или удалить существующий. Куражики - админ устанавливает сколько куражиков начислится если выпадет это приз и вероятность выпадения такого приза. Скидка на товар может быть от 5% до 50% админ также устанавливает вероятность выпадения этого приза. Скидка применяется на существующий товар в маркетплейсе. Бот проверяет какие товары есть и какая цена товара, устанавливает новую цену для пользователя и специально для него генерирует индивидуальную платежную ссылку с новой ценой. Специальный приз, любой приз который придумает администратор, при выпадении такого приза, в админский чат приходит уведомление о выигрыше специального приза (описание приза) и данными для обратной связи с пользователем выигравшим приз и просьбой связаться с победителем. Количество призов в колесе фортуны не ограничено сумма вероятностей выигрыша не может привышать 100% (об этом также нужно уведомлять администратора в инструкции к управлению колесом фортуны которая приходит в сообщении при переходе в меню управления колесом фортуны). Все призы сохраняются в бд.

"Управление товарами" - эта кнопка дает возможность добавлять и удалять товары на маркетплейсе в боте. Должна быть реализована логика добавления товара (создание карточки товара), администратор должен загрузить фото товара, название товара, описание товара, цену за деньги, цену за куражики и количество товара. После добавления товара администартор может удалить товар, изменить количество, цену в рублях и куражиках. Все товары добавленные администратором сохраняются в бд. При оплате товара используем робокассу (данные робокассы указываем в файле .env, должен быть реализован боевой и тестовый режим робокассы. Ссылка на оплату товара в разделе Description должна передавать только название товара, количество товара 1, корзину мы не делаем и не даем возможность покупать более 1 товара за одну транзакцию. Подтверждаем транзакцию через вебхук, также нужно реализовать эту логику).

"Управление играми" - эта кнопка дает возможность создать и управлять созданными играми. Админ видит все активные игры и может отменить игру или изменить время и дату проведения. После изменений всем зарегистрированным на игру пользователям приходит уведомление об отмене или изменении времени или дате проведения игры. При отмене игры всем пользователям оплатившим участие в игре возвращаются деньги (если оплата была через робокассу, нужно реализовать возврат средств) или куражики.

"Создать мероприятие" - эта кнопка дает возможность админу создать мероприятие. Мероприятие может быть платным (должна быть реализована оплата при записи пользователем). При создании указывается дата время, место проведения и количество участников. Всем пользователям приходит автоматическое уведомление о мероприятии (сразу после создания) с кнопкой "Записаться". 

"Рассылка" - эта кнопка дает возможность администратору произвести рассылку всем типам пользователей в боте. При нажатии на кнопку админ выбирает кому будет произведена рассылка - Всем пользователям бота, по квалификации (при выборе этой опции дальше должен выйти список квалификаций и админ должен выбрать квалификацию для рассылки), Партнерам, после выбора типа рассылки админ должен прикрепить фото с описанием (или без фото, просто текст) и отправить в бот. Бот в ответ присылает Этот пост для рассылки с инлайн кнопками "Отправить сейчас", "Запланировать отправку". При выборе запланировать отправку бот запрашивает дату и время когда произвести рассылку.

"Управление активностями" - эта кнопка дает возможность установить вознаграждение пользователей бота за размещение рекламных постов о "Студии Кураж-Продаж" в соц.сетях. (Посты Telegram, Посты Instagram, Посты Одноклассники, Посты ВКонтакте) для каждой соцсети устанавливается отдельное вознаграждение в куражиках. 

"Статистика" - Эта кнопка дает возможность посмотреть все статистики, Сколько пользователей в боте всего, Сколько начислено Куражиков всего, Топ-10 Самых активных (по размещению постов и привлечению рефералов), Сколько куплено товаров всего и рейтинг самых популярных товаров, сколько игр проведено всего, сколько игр отменено, сколько игр ждет проведения.







